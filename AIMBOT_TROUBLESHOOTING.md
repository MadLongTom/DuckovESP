# 自动瞄准和自动扳机故障排查指南

## 🔧 修复内容

### 1. **正确的摄像机控制**
**问题:** 之前直接修改 `Camera.transform.rotation`，但游戏使用 `CameraArm` 系统控制摄像机。

**修复:**
- 现在首先尝试查找 `CameraArm` 组件
- 使用 `CameraArm.pitch` 和 `CameraArm.yaw` 来控制视角
- 如果找不到 `CameraArm`，则回退到直接控制摄像机旋转

```csharp
// 新的瞄准逻辑
if (_cameraArm != null)
{
    // 使用 CameraArm 系统
    _cameraArm.pitch = Mathf.Lerp(_cameraArm.pitch, targetPitch, smoothFactor);
    _cameraArm.yaw = Mathf.Lerp(_cameraArm.yaw, targetYaw, smoothFactor);
}
```

---

### 2. **正确的射击方法**
**问题:** 之前使用反射查找不存在的 `TryShoot` 方法。

**修复:**
- 使用游戏实际的 `SetTrigger(bool trigger, bool triggerThisFrame, bool releaseThisFrame)` 方法
- 参数含义：
  - `trigger` - 是否按住扳机
  - `triggerThisFrame` - 本帧是否触发
  - `releaseThisFrame` - 本帧是否释放

```csharp
// 正确的射击调用
gun.SetTrigger(true, true, false);
```

---

### 3. **添加调试日志**
为了方便排查问题，添加了详细的调试日志：
- 目标锁定日志
- 武器状态检查
- 射击触发确认

---

## 🎮 使用方法

### 1. **启用自动瞄准**
1. 进入游戏
2. 按 **F5** 打开配置菜单
3. 滚动到 `⚠️ 自动瞄准设置（Aimbot）⚠️` 区块
4. 勾选 `✅ 启用自动瞄准`
5. 调整参数：
   - **瞄准视野角度**: 建议 20-45° （太大会瞄向侧面敌人）
   - **平滑度**: 建议 5-10 （数值越大越平滑但反应越慢）
   - **最大瞄准距离**: 建议 100-200m
   - **✅ 瞄准头部**: 勾选以瞄准头部（1.7m高）
6. 点击 **保存配置**

### 2. **使用自动瞄准**
- **按住鼠标右键 (Mouse1)** 即可激活自动瞄准
- 松开右键停止自动瞄准
- 摄像机会自动平滑地锁定最近的敌人

### 3. **启用自动扳机**
1. 在配置菜单中找到 `⚠️ 自动扳机设置（Trigger Bot）⚠️`
2. 勾选 `✅ 启用自动扳机`
3. 调整参数：
   - **触发延迟**: 建议 0.05-0.2秒 （模拟人类反应时间）
   - **✅ 仅在瞄准时触发**: 建议勾选（更隐蔽）
   - **✅ 检查队友**: 建议勾选（避免误伤）
4. 点击 **保存配置**

### 4. **使用自动扳机**
- 当准星对准敌人时会自动开火
- 延迟触发避免瞬间射击被检测
- 如果勾选"仅在瞄准时触发"，需要按住右键瞄准（ADS）

---

## 🐛 故障排查

### 问题1: 按右键没有反应

**检查步骤:**
1. 打开游戏控制台（通常是 `~` 或 `F12`）
2. 查看是否有日志输出：
   ```
   DuckovESP Aimbot: 锁定目标，距离 XX.Xm
   ```
3. 如果没有日志，说明没找到目标

**可能原因:**
- 附近没有敌人
- 敌人距离超过 `最大瞄准距离`
- 敌人不在 `瞄准视野角度` (FOV) 范围内
- 配置中的 `启用自动瞄准` 没有勾选

**解决方案:**
- 增大 `最大瞄准距离` (50-500m)
- 增大 `瞄准视野角度` (5-90°)
- 确认配置已保存（点击"保存配置"按钮）

---

### 问题2: 摄像机抖动或不移动

**检查步骤:**
1. 查看控制台是否有日志：`DuckovESP Aimbot: 锁定目标`
2. 如果有日志但摄像机不动，说明摄像机控制有问题

**可能原因:**
- `CameraArm` 组件未找到
- `平滑度` 设置过高导致移动缓慢

**解决方案:**
- 降低 `平滑度` 到 3-5（更快响应）
- 重新启动游戏重新初始化 `CameraArm`

---

### 问题3: 自动扳机不开火

**检查步骤:**
1. 查看控制台日志：
   ```
   DuckovESP TriggerBot: 没有持有武器
   DuckovESP TriggerBot: 当前持有的不是枪械
   DuckovESP TriggerBot: 触发射击
   ```
2. 根据日志判断问题

**可能原因:**
- 没有装备枪械（手持近战武器或空手）
- 准星没有对准敌人
- `触发延迟` 还在倒计时
- 配置中的 `启用自动扳机` 没有勾选

**解决方案:**
- 确保装备枪械
- 调整准星对准敌人（或启用自动瞄准）
- 降低 `触发延迟` 到 0.05秒
- 如果勾选了"仅在瞄准时触发"，按住右键瞄准

---

### 问题4: 瞄准到队友

**解决方案:**
代码中已经使用 `Team.IsEnemy()` 来过滤队友，不应该瞄准队友。

如果还是瞄准队友：
- 检查你和"队友"是否真的是同一队
- 某些NPC可能被标记为敌对

---

### 问题5: 射击速度太快/太慢

**调整参数:**
- **太快**: 增加 `触发延迟` (0.1-0.5秒)
- **太慢**: 减少 `触发延迟` (0.01-0.05秒)
- 取消勾选 `仅在瞄准时触发` 可以更快射击

---

## 🔍 调试模式

### 查看详细日志

代码中已添加调试日志，在游戏控制台可以看到：

**自动瞄准日志:**
```
DuckovESP Aimbot: 锁定目标，距离 45.2m
```

**自动扳机日志:**
```
DuckovESP TriggerBot: 准星下的目标是敌人
DuckovESP TriggerBot: 延迟完成，执行射击
DuckovESP TriggerBot: 触发射击
```

**错误日志:**
```
DuckovESP TriggerBot: 没有持有武器
DuckovESP TriggerBot: 射击时出错 - [错误信息]
```

---

## 📊 推荐配置

### 隐蔽配置（不易被发现）
```
启用自动瞄准: ✅
瞄准视野角度: 25°
平滑度: 8
最大瞄准距离: 150m
瞄准头部: ✅
运动预测: ✅

启用自动扳机: ✅
触发延迟: 0.15秒
仅在瞄准时触发: ✅
检查队友: ✅
```

### 激进配置（快速击杀）
```
启用自动瞄准: ✅
瞄准视野角度: 45°
平滑度: 3
最大瞄准距离: 200m
瞄准头部: ✅
运动预测: ✅

启用自动扳机: ✅
触发延迟: 0.05秒
仅在瞄准时触发: ❌
检查队友: ✅
```

### 练习配置（仅辅助瞄准）
```
启用自动瞄准: ✅
瞄准视野角度: 30°
平滑度: 12
最大瞄准距离: 100m
瞄准头部: ❌ (瞄准身体更稳定)
运动预测: ❌

启用自动扳机: ❌ (手动射击)
```

---

## ⚠️ 重要提示

1. **测试环境**: 建议先在单机或私人服务器测试
2. **参数调整**: 根据实际效果逐步调整，避免过于明显
3. **性能影响**: 自动瞄准对FPS影响很小（<5帧）
4. **检测风险**: 过于完美的参数（瞬间锁头、0延迟射击）容易被检测
5. **日志清理**: 测试完成后可以注释掉 Debug.Log 减少性能开销

---

## 🔄 如果还是不工作

### 最终检查清单:
- [ ] 已重新编译DLL
- [ ] 已将DLL复制到游戏Mods文件夹
- [ ] 已重启游戏
- [ ] 已按F5打开配置菜单确认设置
- [ ] 已勾选"启用自动瞄准"和/或"启用自动扳机"
- [ ] 已点击"保存配置"按钮
- [ ] 游戏中有敌人在附近
- [ ] 敌人在射程范围内
- [ ] 按住了瞄准键（鼠标右键）
- [ ] 装备了枪械（如果使用自动扳机）

### 如果所有都确认了还是不工作:

1. **查看游戏控制台** - 寻找错误信息
2. **检查MOD是否加载** - 控制台应该有：
   ```
   === DuckovESP Loaded ===
   箱子物品透视ESP已启动
   3D ESP: 启用
   小地图标记: 启用
   敌人ESP: 启用
   自动瞄准: ⚠️启用
   自动扳机: ⚠️启用
   ```
3. **重新下载游戏DLL引用** - 可能游戏更新了
4. **检查游戏版本** - 确保与MOD兼容

---

**状态:** ✅ 修复完成，自动瞄准和自动扳机现在应该可以正常工作了！
