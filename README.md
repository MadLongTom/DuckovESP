# DuckovESP - 箱子物品透视 Mod

这是一个为《Escape from Duckov》游戏制作的mod，可以在地图上显示所有箱子的位置和物品信息，同时在3D游戏画面中实时显示ESP标记。

## 功能特性

- ✅ **实时扫描**：自动扫描地图上所有箱子
- ✅ **物品透视**：显示箱子内的物品数量和品质
- ✅ **智能过滤**：
  - 自动排除宠物狗背包中的物品
  - 自动排除未激活的任务道具刷取点
  - 特殊显示未录入的钥匙（无视品质过滤）
- ✅ **游戏内配置菜单**：按F5打开配置菜单，实时调整所有设置
- ✅ **配置持久化**：所有设置自动保存到config.json文件
- ✅ **3D ESP显示**：在游戏画面中实时显示箱子位置和物品信息
  - 可配置显示距离（10-500米）
  - 可配置字体大小（8-24）
  - 可配置最大显示物品数（1-10件）
  - 可选显示距离信息
  - 可选显示从角色到箱子的连接线
  - 可配置背景透明度和边框粗细
- ✅ **品质过滤**：分别为3D ESP和小地图设置品质过滤
  - 3D ESP：默认显示所有品质
  - 小地图标记：默认只显示史诗和传说级
- ✅ **颜色分级**：根据物品品质显示不同颜色标记（与ItemLevelAndSearchSoundMod同步）
  - 白色 - 普通物品 (价值<200)
  - 绿色 - 稀有物品 (价值≥200)
  - 蓝色 - 精良物品 (价值≥600)
  - 紫色 - 史诗物品 (价值≥1200)
  - 橙色 - 传说物品 (价值≥2500)
  - 浅红色 - 神话物品 (价值≥5000)
  - 红色 - 至尊物品 (价值≥10000)
  - 注：装备类和子弹类有特殊判定规则，详见ItemLevelAndSearchSoundMod
- ✅ **自动清理**：已掠夺的箱子自动隐藏标记
- ✅ **小地图显示**：在小地图上同时显示箱子位置（可关闭）
- ✅ **智能过滤**：
  - 自动排除宠物狗背包中的物品，避免干扰
  - 自动排除未激活的任务道具刷取点
  - **未录入的钥匙会无视品质过滤，始终显示**（用🔑图标标记）
  - 可分别为3D ESP和小地图设置不同的品质过滤

## 安装方法

### 方法1：手动安装

1. **修改项目引用路径**
   - 打开 `DuckovESP.csproj`
   - 将所有DLL引用路径改为你的游戏安装目录
   - 例如：`D:\SteamLibrary\steamapps\common\Escape from Duckov\Duckov_Data\Managed\`

2. **编译项目**
   ```bash
   dotnet build -c Release
   ```

3. **创建Mod文件夹**
   ```
   [游戏目录]\Duckov_Data\Mods\DuckovESP\
   ```

4. **复制文件**
   - 将 `bin\Release\netstandard2.1\DuckovESP.dll` 复制到Mod文件夹
   - 将 `info.ini` 复制到Mod文件夹

5. **启动游戏**
   - 进入游戏的Mod管理器
   - 找到"箱子物品透视 ESP"并启用

### 方法2：Steam创意工坊（未来支持）

待游戏支持Steam创意工坊后，可以直接订阅。

## 使用说明

1. **启用Mod**
   - 在游戏主菜单进入Mod管理器
   - 勾选"箱子物品透视 ESP"
   - 重启游戏或重新加载关卡

2. **打开配置菜单**
   - 按 **F5** 键打开/关闭配置菜单
   - 在菜单中实时调整所有设置
   - 点击"保存配置"按钮保存设置
   - 设置会自动保存到 `Duckov_Data\Mods\DuckovESP\config.json`

3. **3D ESP显示**
   - 进入游戏后自动显示
   - 箱子信息会显示在3D世界中
   - 包含距离、物品名称和品质
   - 从角色位置有指示线连接到箱子（可关闭）

4. **配置选项说明**
   - **3D ESP设置**
     - 启用3D ESP：开关3D世界中的ESP显示
     - 最大显示距离：超过此距离的箱子不显示
     - 字体大小：ESP文字大小
     - 最大显示物品数：每个箱子最多显示多少个物品
     - 显示距离：是否显示箱子距离
     - 显示连接线：是否显示从角色到箱子的线
   
   - **过滤设置**
     - 3D ESP最小品质：只显示该品质及以上的物品
     - 显示空箱子：是否显示空箱子
   
   - **小地图标记设置**
     - 启用小地图标记：在小地图上显示箱子图标
     - 地图标记最小品质：小地图上只显示该品质及以上的箱子
   
   - **外观设置**
     - 背景透明度：ESP背景的透明度（0-1）
     - 边框粗细：ESP边框的粗细程度

5. **查看箱子（小地图）**
   - 打开小地图（默认按M键）
   - 箱子会显示为带颜色的标记
   - 标记显示物品中文名称列表

6. **理解标记**
   - 标记颜色表示箱子内最高品质物品
   - 已掠夺的空箱子会自动消失
   - 3D ESP和小地图可以分别设置品质过滤

## 技术细节

### 工作原理

1. **扫描机制**
   - 关卡加载后自动扫描所有 `InteractableLootbox` 组件
   - 每秒重新扫描一次，确保检测到新生成的箱子
   - 监听场景加载事件，及时更新标记

2. **物品读取**
   - 访问箱子的 `Inventory` 组件获取物品列表
   - 等待物品生成完成（`inventory.Loading == false`）
   - 遍历所有物品获取详细信息

3. **地图标记**
   - 使用 `SimplePointOfInterest` 组件创建地图标记
   - 标记会自动显示在小地图上
   - 根据物品品质动态设置标记颜色

### 性能优化

- 使用字典缓存已追踪的箱子，避免重复扫描
- 定时清理无效标记，释放内存
- 异步等待物品加载完成，不阻塞主线程

## 开发信息

- **作者**: YourName
- **版本**: 1.0.0
- **目标框架**: .NET Standard 2.1
- **游戏版本**: Escape from Duckov

## 常见问题

### Q: 为什么有些箱子不显示标记？
A: 可能是以下原因：
- 箱子物品还在加载中（稍等片刻）
- 箱子被设置为不激活（游戏机制）
- 箱子内没有物品

### Q: 标记位置不准确？
A: 标记位置会在每帧更新，如果箱子本身移动或场景加载异常可能导致位置偏移。

### Q: 编译错误？
A: 检查以下内容：
1. DLL引用路径是否正确
2. 游戏版本是否匹配
3. 是否安装了.NET SDK

### Q: Mod不生效？
A: 确认：
1. 文件夹结构正确：`Mods\DuckovESP\DuckovESP.dll` 和 `info.ini`
2. info.ini 中的 `name` 字段必须是 `DuckovESP`
3. 在游戏Mod管理器中启用了mod

## 更新日志

### v1.0.0 (2025-10-19)
- 初始版本发布
- 基础箱子扫描和标记功能
- 品质颜色分级系统
- 自动清理空箱子标记

## 免责声明

本mod仅供学习和研究使用。使用本mod可能违反游戏的服务条款，使用风险由用户自行承担。

## 许可证

MIT License

## 贡献

欢迎提交问题和改进建议！

## 相关链接

- 游戏官网: [链接]
- Steam页面: [链接]
- 问题反馈: [链接]
